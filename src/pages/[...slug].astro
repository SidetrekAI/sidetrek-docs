---
import { getCollection } from 'astro:content'
import Layout from '@/layouts/Layout.astro'
import Main from '@/components/Main.astro'
import H1 from '@/components/H1.astro'
import H2 from '@/components/H2.astro'
import H3 from '@/components/H3.astro'
import P from '@/components/mdx/P.astro'
import UL from '@/components/mdx/UL.astro'
import OL from '@/components/mdx/OL.astro'
import LI from '@/components/mdx/LI.astro'
import SecondarySideMenu from '@/components/SecondarySideMenu'

export async function getStaticPaths() {
  const docsPages = await getCollection('docs', ({ data }) => {
    return import.meta.env.PROD ? data.draft === false : true
  })

  return docsPages.map((page) => {
    return {
      params: {
        slug: page.slug,
      },
      props: {
        page,
      },
    }
  })
}

const { page } = Astro.props
const { Content } = await page.render()
const { title, description } = page.data
---

<Layout title={title} description={description}>
  <div class="md:flex min-w-0 w-full">
    <Main>
      <Content class="content" components={{ h1: H1, h2: H2, h3: H3, p: P, ul: UL, ol: OL, li: LI }} />
    </Main>

    <SecondarySideMenu page={page.body} client:load />
  </div>
</Layout>
